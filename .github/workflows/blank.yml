name: Windows VM Setup

on:
  workflow_dispatch:
    inputs:
      code:
        description: "Paste PowerShell Code"
        required: true
        default: "Write-Host 'Hello from GitHub Actions'"

jobs:
  build:
    name: Windows VM Running
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Download Chrome Remote Desktop
        run: |
          # Download Chrome Remote Desktop installer
          Invoke-WebRequest -Uri "https://dl.google.com/chrome-remote-desktop/chrome_remote_desktop.msi" -OutFile "chrome_remote_desktop.msi"
      
      - name: Install Chrome Remote Desktop
        run: |
          # Install Chrome Remote Desktop silently
          Start-Process "msiexec.exe" -ArgumentList "/i chrome_remote_desktop.msi /quiet /norestart" -NoNewWindow -Wait

      - name: Executing PowerShell Code
        run: |
          # Define the path to the executable
          $executablePath = "$($Env:PROGRAMFILES(X86))\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe"

          # Check if the executable exists
          if (Test-Path $executablePath) {
              # Execute the command with the provided code
              & "$executablePath" --code="${{ inputs.code }}"
          } else {
              Write-Host "Executable not found: $executablePath"
              exit 1
          }

      - name: Keep VM Running
        run: |
          # Go And Connect Now!
          $i = 360
          do {
              Write-Host $i
              Sleep 60
              $i--
          } while ($i -gt 0)
